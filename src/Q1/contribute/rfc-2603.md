## RFC 2603: Rust Symbol Name Mangling v0

ä½œè€…ï¼šç‹æ±Ÿæ¡ã€å‘¨ç´«é¹

---

[RFC 2603](https://rust-lang.github.io/rfcs/2603-rust-symbol-name-mangling-v0.html) æ›´æ–°äº†ç¼–è¯‘å™¨ç”Ÿæˆç»„åçš„è§„åˆ™ï¼Œä½¿å…¶æ›´ä¸€è‡´å¹¶ä¸”æ›´æ˜“è§£ç ã€‚åœ¨ä¹‹åï¼Œè¿™ä¸€è§„åˆ™å¯èƒ½ä¼šæˆä¸ºè¯­è¨€è§„èŒƒæˆ–/å’Œ Rust ç¨³å®š ABI çš„ä¸€éƒ¨åˆ†ï¼Œä¸è¿‡ç›®å‰è¿™ä¸€è§„åˆ™çš„å®ç°åªä¿ç•™åœ¨ Rust ç¼–è¯‘å™¨çš„é€»è¾‘é‡Œã€‚

ç›®å‰çš„ç»„åè§„åˆ™å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

- ç»„åè¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨æ³›å‹å‚æ•°ä»¥åŠå…¶ä»–ä¿¡æ¯çš„ä¸¢å¤±ï¼Œæ— æ³•ä»ç¬¦å·åç§°ä¸­è¾¨è®¤å‡ºåŸå…ˆçš„ç±»å‹å‚æ•°ï¼›
- ç°æœ‰çš„è§„åˆ™å¹¶ä¸ä¸€è‡´ï¼Œå¤§éƒ¨åˆ†éµä» [Itanium ABI](http://refspecs.linuxbase.org/cxxabi-1.86.html#mangling) è§„åˆ™ï¼Œä½†æ˜¯æœ‰ä¸€äº›å¹¶ä¸æ˜¯è¿™æ ·ï¼›
- æœ‰äº›ç¬¦å·åå­—ä¼šåŒ…å«ç¬¦å· `.`ï¼Œä½†æ˜¯è¿™ä¸€ç¬¦å·å¹¶ä¸è¢«æ‰€æœ‰å¹³å°æ”¯æŒï¼›
- ç›®å‰ç¬¦å·çš„ç”Ÿæˆä¸ç¼–è¯‘å™¨å†…éƒ¨é€»è¾‘å¼ºè€¦åˆï¼Œç”Ÿæˆçš„ç¬¦å·åå­—æ— æ³•è¢«å…¶ä»–ç¼–è¯‘å™¨å®ç°æˆ–å¤–éƒ¨å·¥å…·å¤ç°ã€‚
  - ç›®å‰çš„ç»„åä¼šåŒ…å«ä¸€ä¸ªå“ˆå¸Œå€¼æ¥ç¡®ä¿ä¸åŒçš„å‡½æ•°æœ€åä¼šæ˜ å°„ä¸åŒçš„ç¬¦å·åï¼Œå“ˆå¸Œå€¼ç”±ç¼–è¯‘å™¨çš„å†…éƒ¨é€»è¾‘ç”Ÿæˆï¼Œè¿™å¯¼è‡´äº†ç»„åæ— æ³•è¢«å¿«é€Ÿå¤ç°ã€‚

æ–°çš„è§„åˆ™ä¸€ä¸€ä¿®å¤äº†è¿™äº›é—®é¢˜ï¼Œå¹¶å»é™¤äº†å“ˆå¸Œå€¼ã€‚


### ç»„åè§„åˆ™ä¸ä¾‹å­

#### Unicode å‚æ•°å

Rust å…è®¸ Unicode å‚æ•°åï¼Œä¸è¿‡ä¼šä½¿ç”¨ [Punycode](https://tools.ietf.org/html/rfc3492) ç¼–ç å°†å…¶è½¬æ¢ä¸º ASCII å­—ç¬¦ä¸²ã€‚ç¼–ç ä¸¾ä¾‹å¦‚ä¸‹ï¼š

| Original | Punycode | Punycode + Encoding |
| -------- | -------- | ------------------- |
| fÃ¸Ã¸      | f-5gaa   | f_5gaa              |
| Î±_Ï‰      | _-ylb7e  | __ylb7e             |
| é“é”ˆ     | n84amf   | n84amf              |
| ğŸ¤¦        | fq9h     | fq9h                |
| ÏÏ…ÏƒÏ„     | 2xaedc   | 2xaedc              |



å¯¹äºä»¥ä¸‹æ¨¡å—ï¼š

```rust
mod gÃ¶del {
  mod escher {
    fn bach() {}
  }
}
```

ç»„åä¸ºï¼š

```
_RNvNtNtC7mycrateu8gdel_5qa6escher4bach
                 <-------->
              Unicode component

```

è½¬æ¢ç»„åæ—¶ï¼Œåœ¨ç¼–ç ä¹‹åï¼Œä¼šåœ¨å¼€å¤´æ·»åŠ  `u` è¡¨ç¤ºè¿™æ˜¯ Unicode éƒ¨åˆ†ã€‚



#### æ— æ³›å‹å‚æ•°çš„å‡½æ•°

å¯¹äºä»¥ä¸‹å¯ä»¥é€šè¿‡ç»å¯¹è·¯å¾„ç¡®å®šçš„å‡½æ•° `bar`ï¼š

```rust
mod foo {
  fn bar() {}
}
```

å…¶å¯¹åº”ç»„åå¯èƒ½ä¸º `NNC7mycrate3foo3bar`ã€‚å­—æ¯ `N` è¡¨ç¤ºå¼€å§‹æ ‡è®°ï¼ˆStart-Tagï¼‰ã€‚ä¸ºäº†åŒºåˆ†ä¸åŒ crate ä¸­çš„åŒåå‡½æ•°ï¼Œç»„åéœ€è¦åŒ…å« crate-idï¼Œcrate-id ä»¥ `C` ä½œä¸ºå¼€å§‹æ ‡è®°ã€‚æ•°å­— 3 æ¥è‡ªæ¸¸ç¨‹ç¼–ç ï¼Œå½¢ä¼¼äº [Itanium C++ ABI](http://refspecs.linuxbase.org/cxxabi-1.86.html#mangling) ç”¨äºæ ‡è¯†ç¬¦çš„ç¼–ç æ ¼å¼ã€‚æ¸¸ç¨‹ç¼–ç ï¼ˆRun-Length Encodingï¼ŒRLEï¼‰ï¼Œåˆç§°è¡Œç¨‹é•¿åº¦ç¼–ç æˆ–å˜åŠ¨é•¿åº¦ç¼–ç æ³•ï¼Œæ˜¯ä¸€ç§ä¸èµ„æ–™æ€§è´¨æ— å…³çš„æ— æŸæ•°æ®å‹ç¼©æŠ€æœ¯ï¼ŒåŸºäºâ€œä½¿ç”¨å˜åŠ¨é•¿åº¦çš„ç æ¥å–ä»£è¿ç»­é‡å¤å‡ºç°çš„åŸå§‹èµ„æ–™æ¥å®ç°å‹ç¼©ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸€ç»„èµ„æ–™ä¸²"AAAABBBCCDEEEE"ï¼Œç”±4ä¸ªAã€3ä¸ªBã€2ä¸ªCã€1ä¸ªDã€4ä¸ªEç»„æˆï¼Œç»è¿‡å˜åŠ¨é•¿åº¦ç¼–ç æ³•å¯å°†èµ„æ–™å‹ç¼©ä¸º4A3B2C1D4Eï¼ˆç”±14ä¸ªå•ä½è½¬æˆ10ä¸ªå•ä½ï¼‰ã€‚

å¯¹äºåŒåä½†æ˜¯ç±»å‹ä¸åŒçš„ä¸¤ä¸ªå‡½æ•°ï¼š

```rust
fn foo() {
    fn bar() {}
}

mod foo {
    fn bar() {}
}
```

å‰è€…ç»„åä¸º `NvNvC7mycrate3foo3bar `ï¼Œåè€…ç»„åä¸º `NvNtC7mycrate3foo3bar `ï¼Œæ¥åŒºåˆ†å‰è€…ï¼Œå³å‡½æ•° `foo` ï¼Œå®šä¹‰äºå€¼å‘½åç©ºé—´ï¼Œè€Œåè€…ï¼Œå³æ¨¡å— `foo`ï¼Œå®šä¹‰äºç±»å‹å‘½åç©ºé—´ã€‚

åœ¨ä½¿ç”¨å®çš„æƒ…å†µä¸‹ï¼Œåœ¨åŒä¸€ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ä¾‹å¯èƒ½ä¼šå«æœ‰é‡åçš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š

```rust
mod foo {
    fn bar'0() {}
    // The second `bar` function was introduced by macro expansion.
    fn bar'1() {}
}
```

ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¢åŠ æ•°å­—ç´¢å¼•æ¥åŒºåˆ†è¿™ä¸¤è€…ï¼Œç”Ÿæˆçš„ç»„ååˆ†åˆ«ä¸º `NvNtC7mycrate3foo3bar ` å’Œ `NvNtC7mycrate3foos_3bar `ã€‚`s_` ä»£è¡¨è¯¥åŒåå‡½æ•°çš„ç¬¬äºŒç§æƒ…å†µã€‚è¿™ä¸€åŒºåˆ†è§„åˆ™ä¹ŸåŒæ ·åº”ç”¨äºåŒºåˆ†åŒå crateã€‚

Rust ä¸å…è®¸å‡½æ•°é‡è½½ï¼Œå³å‡½æ•°åŒåï¼Œä½†æ˜¯å‚æ•°ä¸åŒçš„æƒ…å†µã€‚ç»„åä¸éœ€è¦å¯¹æ­¤ç§æƒ…å†µè¿›è¡ŒåŒºåˆ†ã€‚

æœ€åï¼Œå®Œæ•´ç”Ÿæˆçš„ç»„åå¯èƒ½ä¼šåŒ…å«ä¸€ä¸ª `_R` å‰ç¼€ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š

```
_RNvNtCs1234_7mycrate3foo3bar
<>^^^^^<----><------><--><-->
||||||   |      |     |   |
||||||   |      |     |   +--- "bar" identifier
||||||   |      |     +------- "foo" identifier
||||||   |      +------------- "mycrate" identifier
||||||   +-------------------- disambiguator for "mycrate"
|||||+------------------------ start-tag for "mycrate"
||||+------------------------- namespace tag for "foo"
|||+-------------------------- start-tag for "foo"
||+--------------------------- namespace tag for "bar"
|+---------------------------- start-tag for "bar"
+----------------------------- common Rust symbol prefix
```



#### æ³›å‹å‡½æ•°

æ³›å‹å‡½æ•°çš„å…·ä½“å‚æ•°ä¼šæ·»åŠ åˆ°ç»„åä¸­ï¼Œä»¥ `I` ä½œä¸ºå¼€å§‹æ ‡è®°ï¼Œæ¥åŒºåˆ†ä¸åŒçš„æ³›å‹å‡½æ•°ã€‚ä¾‹å¦‚ï¼š

```rust
std::mem::align_of::<f64>
```

ç»„åä¸ºï¼š

```
_RINvNtC3std3mem8align_ofdE
  ^                      ^^
  |                      ||
  |                      |+--- end of argument list
  |                      +--- f64
  +--- start-tag
```

åŸå§‹ç±»å‹ä¼šéµä» Itanium è§„èŒƒï¼Œç¼–ç ä¸ºå•ä¸€çš„å°å†™å­—æ¯ï¼Œå…¶ä»–çš„å…·ä½“ç±»å‹ä¼šä»¥å®ƒä»¬çš„ç»å¯¹è·¯å¾„ç¼–ç ï¼Œå½¢å¼ç±»ä¼¼äºç¼–ç æ— åçœå‚æ•°çš„å‡½æ•°ã€‚å¼•ç”¨ã€å…ƒç»„ã€ä»¥åŠå‡½æ•°æŒ‡é’ˆåˆ™ä»¥å¦‚ä¸‹ä¾‹å­ä¸­çš„è§„åˆ™ç¼–ç ï¼š

```
std::mem::align_of::<usize>: _RINvNtC3std3mem8align_ofjE
std::mem::align_of::<&char>: _RINvNtC3std3mem8align_ofRcE
std::mem::align_of::<std::mem::Discriminant>: _RINvNtC3std3mem8align_ofNtNtC3std3mem12DiscriminantE
std::mem::align_of::<&mut (&str,())>: _RINvNtC3std3mem8align_ofQTReuEE
```

åŒæ ·ï¼Œä¸ºäº†åŒºåˆ†ä¸åŒä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚ä¸åŒ crateï¼‰ä¸­çš„åŒåæ³›å‹å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šåœ¨åç¼€æ·»åŠ  crate-idï¼š

```
_RINvNtC3std3mem8align_ofjEC3foo (for crate "foo")
_RINvNtC3std3mem8align_ofjEC3bar (for crate "bar")
```



#### é—­åŒ…

ç¼–è¯‘å™¨ä¼šä¸ºåŒ¿åå‡½æ•°é—­åŒ…ç”Ÿæˆåå­—ï¼Œè¿™ä¸ªåå­—ä¼šç”¨äºç¼–è¯‘ç»„åã€‚ä¾‹å¦‚ï¼š

```rust
mod foo {
  fn bar(x: u32) {
    let a = |x| { x + 1 }; // local name: NC<...>0
    let b = |x| { x + 2 }; // local name: NC<...>s_0

    a(b(x))
  }
}
```

é—­åŒ…çš„å±€éƒ¨åç§°ä¸º `NC<...>0`ï¼Œ`C` æ˜¯å‘½ååŸŸæ ‡è®°ï¼Œ`<...>` éƒ¨åˆ†åˆ™è¡¨ç¤ºçˆ¶è·¯å¾„ï¼Œæ•°å­— 0 ä»£è¡¨å®ƒä»¬çš„åå­—é•¿åº¦ä¸º0ã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªé—­åŒ…çš„ç»„ååˆ†åˆ«ä¸º `NCNvNtC7mycrate3foo3bar0 ` ä»¥åŠ `NCNvNtC7mycrate3foo3bars_0 `ã€‚



#### æ–¹æ³•

æ–¹æ³•çš„ç»„åè§„åˆ™å¦‚ä¸‹ï¼š

- å¯¹äºå†…éƒ¨ `impl` å—ï¼še.g. `<Foo<u32, char>>::some_method`
- å¯¹äº trait æ–¹æ³•ï¼še.g. `<Foo<u32, char> as SomeTrait<Quux>>::some_method`

çˆ¶è·¯å¾„ä¸ä»…åŒ…å« crate-idï¼Œè€Œæ˜¯ä»¥ `impl` å—å¼€å¤´ï¼Œ`impl` å—åŒ…å«è‡ªèº«çš„ç±»å‹ä»¥åŠå®ç°çš„ trait åã€‚æ‰©å±•åçš„çˆ¶è·¯å¾„åŒ…å«å¦‚ä¸‹è¯­æ³•ï¼š

```
<path> = C <identifier>                      // crate-id root
       | M <type>                            // inherent impl root
       | X <type> <path>                     // trait impl root
       | N <namespace> <path> <identifier>   // nested path
       | I <path> {<generic-arg>} E          // generic arguments
       
<impl-path> = [<disambiguator>] <path>
```

å®é™…ä¾‹å­ï¼š

```
<mycrate::Foo<u32>>::foo => _RNvMINtC7mycrate3FoomE3foo
<u32 as mycrate::Foo>::foo => _RNvXmNtC7mycrate3Foo3foo
<mycrate::Foo<u32> as mycrate::Bar<u64>>::foo => _RNvXINtC7mycrate3FoomEINtC7mycrate3BaryE3foo
```



#### æ³›å‹ trait ä¸­çš„ç±»å‹

åœ¨å¦‚ä¸‹ä¾‹å­ä¸­ï¼š

```rust
#![allow(unused)]
fn main() {
    struct Foo<T>(T);

    impl<T> From<T> for Foo<T> {
      default fn from(x: T) -> Self {
        static MSG: &str = "...";
        panic!("{}", MSG)
      }
    }

    impl<T: Default> From<T> for Foo<T> {
      fn from(x: T) -> Self {
        static MSG: &str = "123";
        panic!("{}", MSG)
      }
    }
}
```

`MSG` çš„ç»å¯¹è·¯å¾„ä¸º `<Foo<_> as From<_>>::foo::MSG`ã€‚ä¸¤ä¸ª trait éƒ½æ˜¯ `From`ï¼Œå› æ­¤éœ€è¦åœ¨ç»„åä¸­æ·»åŠ çˆ¶è·¯å¾„æ¥åŒºåˆ†è¿™ä¸¤ä¸ª traitã€‚

å¯¹åº”çš„ç»„åä¸ºï¼š

```
_RNvNvXs2_C7mycrateINtC7mycrate3FoopEINtNtC3std7convert4FrompE4from3MSG
_RNvNvXs3_C7mycrateINtC7mycrate3FoopEINtNtC3std7convert4FrompE4from3MSG
       <----------><----------------><----------------------->
        impl-path      self-type            trait-name

```



#### å‹ç¼©å’Œæ›¿ä»£

åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒRust æ³›å‹ä¼šå¯¼è‡´å‚æ•°çš„ç»å¯¹åå­—éå¸¸é•¿ï¼Œè€Œå‚æ•°çš„åå­—é•¿åº¦ä¼šå½±å“ç¼–è¯‘å™¨ã€é“¾æ¥å™¨ã€ç­‰å…¶å®ƒç¨‹åºçš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå¦‚ä¸‹å‡½æ•°ï¼š

```rust
#![allow(unused)]
fn main() {
    fn quux(s: Vec<u32>) -> impl Iterator<Item = (u32, usize)> {
        s.into_iter()
         .map(|x| x + 1)
         .filter(|&x| x > 10)
         .zip(0..)
         .chain(iter::once((0, 0)))
    }
}
```

å®ƒçš„è¿”å›å€¼ä¸ºï¼š

```
std::iter::Chain<
  std::iter::Zip<
    std::iter::Filter<
      std::iter::Map<
        std::vec::IntoIter<u32>,
        [closure@src/main.rs:16:11: 16:18]>,
      [closure@src/main.rs:17:14: 17:25]>,
    std::ops::RangeFrom<usize>>,
  std::iter::Once<(u32, usize)>>
```

å¯¹äºæ­¤ç§æƒ…å†µï¼Œå¦‚æœå®šä¹‰ä¸­æŸä¸€éƒ¨åˆ†å‡ºç°äº†å¤šæ¬¡ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šé‡‡ç”¨å‹ç¼©ç®—æ³•ï¼Œä½¿ç”¨æŸä¸€ä¸ªæ ‡è®°æ¥æ›¿ä»£è¿™ä¸€é‡å¤å…ƒç´ ã€‚ç²—ç•¥æ¥è¯´ï¼Œè¿™ä¸€ç®—æ³•ä¸ºï¼šå½“ç»„åå¼€å§‹æ—¶ï¼Œå¯¹äºåç»­å‡ºç°çš„é‡å¤éƒ¨åˆ†ï¼Œä»¥åå‘å¼•ç”¨ä»£æ›¿ã€‚åå‘å¼•ç”¨çš„å½¢å¼ä¸º `B<base-62-number>_`ã€‚

å¯ä»¥æ›¿ä»£çš„éƒ¨åˆ†æœ‰ï¼š

- æ‰€æœ‰è·¯å¾„çš„å‰ç¼€ï¼Œä»¥åŠé‡å¤è·¯å¾„æœ¬èº«
- é™¤äº†åŸºç¡€ç±»å‹ä»¥å¤–çš„æ‰€æœ‰ç±»å‹
- ç±»å‹çº§å¸¸é‡

ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹å‚æ•°åï¼š

```rust
std::iter::Chain<std::iter::Zip<std::vec::IntoIter<u32>, std::vec::IntoIter<u32>>>
```

ä¸ä½¿ç”¨å‹ç¼©çš„æƒ…å†µä¸‹ï¼Œå®Œæ•´çš„ç»„åä¸ºï¼š

```
  0         10        20        30        40        50        60        70        80        90
_RINtNtC3std4iter5ChainINtNtC3std4iter3ZipINtNtC3std3vec8IntoItermEINtNtC3std3vec8IntoItermEEE
                            5----              5----                    5----
                          3-----------                                43---------
                                                                    41--------------------
                                                                   40-----------------------
```

å‹ç¼©ä¹‹åçš„ç»„åä¸ºï¼š

```
_RINtNtC3std4iter5ChainINtB2_3ZipINtNtB4_3vec8IntoItermEBt_EE
                          ^^^         ^^^               ^^^     back references
```





#### å®Œæ•´çš„ç»„åè¯­æ³•é›†

- éç»ˆç«¯ç›¸å…³å‚æ•°ç”±å°–æ‹¬å·è¡¨ç¤ºï¼ˆe.g. `<path>`ï¼‰
- ç»ˆç«¯ç›¸å…³ä»¥åŒå¼•å·è¡¨ç¤ºï¼ˆe.g. `"_R"`ï¼‰
- å¯é€‰é¡¹ä»¥æ–¹æ‹¬å·è¡¨ç¤ºï¼ˆe.g. `[<disambiguator>]`ï¼‰
- é‡å¤é¡¹ï¼ˆ0æˆ–å¤šæ¬¡ï¼‰ç”±èŠ±æ‹¬å·è¡¨ç¤ºï¼ˆe.g. `{<type>}`ï¼‰
- å¤‡æ³¨ç”± `//` è¡¨ç¤º

```
// The <decimal-number> specifies the encoding version.
<symbol-name> =
    "_R" [<decimal-number>] <path> [<instantiating-crate>] [<vendor-specific-suffix>]

<path> = "C" <identifier>                    // crate root
       | "M" <impl-path> <type>              // <T> (inherent impl)
       | "X" <impl-path> <type> <path>       // <T as Trait> (trait impl)
       | "Y" <type> <path>                   // <T as Trait> (trait definition)
       | "N" <namespace> <path> <identifier> // ...::ident (nested path)
       | "I" <path> {<generic-arg>} "E"      // ...<T, U> (generic args)
       | <backref>

// Path to an impl (without the Self type or the trait).
// The <path> is the parent, while the <disambiguator> distinguishes
// between impls in that same parent (e.g. multiple impls in a mod).
// This exists as a simple way of ensure uniqueness, and demanglers
// don't need to show it (unless the location of the impl is desired).
<impl-path> = [<disambiguator>] <path>

// The <decimal-number> is the length of the identifier in bytes.
// <bytes> is the identifier itself, and it's optionally preceded by "_",
// to separate it from its length - this "_" is mandatory if the <bytes>
// starts with a decimal digit, or "_", in order to keep it unambiguous.
// If the "u" is present then <bytes> is Punycode-encoded.
<identifier> = [<disambiguator>] <undisambiguated-identifier>
<disambiguator> = "s" <base-62-number>
<undisambiguated-identifier> = ["u"] <decimal-number> ["_"] <bytes>

// Namespace of the identifier in a (nested) path.
// It's an a-zA-Z character, with a-z reserved for implementation-internal
// disambiguation categories (and demanglers should never show them), while
// A-Z are used for special namespaces (e.g. closures), which the demangler
// can show in a special way (e.g. `NC...` as `...::{closure}`), or just
// default to showing the uppercase character.
<namespace> = "C"      // closure
            | "S"      // shim
            | <A-Z>    // other special namespaces
            | <a-z>    // internal namespaces

<generic-arg> = <lifetime>
              | <type>
              | "K" <const> // forward-compat for const generics

// An anonymous (numbered) lifetime, either erased or higher-ranked.
// Index 0 is always erased (can show as '_, if at all), while indices
// starting from 1 refer (as de Bruijn indices) to a higher-ranked
// lifetime bound by one of the enclosing <binder>s.
<lifetime> = "L" <base-62-number>

// Specify the number of higher-ranked (for<...>) lifetimes to bound.
// <lifetime> can then later refer to them, with lowest indices for
// innermost lifetimes, e.g. in `for<'a, 'b> fn(for<'c> fn(...))`,
// any <lifetime>s in ... (but not inside more binders) will observe
// the indices 1, 2, and 3 refer to 'c, 'b, and 'a, respectively.
// The number of bound lifetimes is value of <base-62-number> + 1.
<binder> = "G" <base-62-number>

<type> = <basic-type>
       | <path>                      // named type
       | "A" <type> <const>          // [T; N]
       | "S" <type>                  // [T]
       | "T" {<type>} "E"            // (T1, T2, T3, ...)
       | "R" [<lifetime>] <type>     // &T
       | "Q" [<lifetime>] <type>     // &mut T
       | "P" <type>                  // *const T
       | "O" <type>                  // *mut T
       | "F" <fn-sig>                // fn(...) -> ...
       | "D" <dyn-bounds> <lifetime> // dyn Trait<Assoc = X> + Send + 'a
       | <backref>

<basic-type> = "a"      // i8
             | "b"      // bool
             | "c"      // char
             | "d"      // f64
             | "e"      // str
             | "f"      // f32
             | "h"      // u8
             | "i"      // isize
             | "j"      // usize
             | "l"      // i32
             | "m"      // u32
             | "n"      // i128
             | "o"      // u128
             | "s"      // i16
             | "t"      // u16
             | "u"      // ()
             | "v"      // ...
             | "x"      // i64
             | "y"      // u64
             | "z"      // !
             | "p"      // placeholder (e.g. for generic params), shown as _

// If the "U" is present then the function is `unsafe`.
// The return type is always present, but demanglers can
// choose to omit the ` -> ()` by special-casing "u".
<fn-sig> = [<binder>] ["U"] ["K" <abi>] {<type>} "E" <type>

<abi> = "C"
      | <undisambiguated-identifier>

<dyn-bounds> = [<binder>] {<dyn-trait>} "E"
<dyn-trait> = <path> {<dyn-trait-assoc-binding>}
<dyn-trait-assoc-binding> = "p" <undisambiguated-identifier> <type>
<const> = <type> <const-data>
        | "p" // placeholder, shown as _
        | <backref>

// The encoding of a constant depends on its type. Integers use their value,
// in base 16 (0-9a-f), not their memory representation. Negative integer
// values are preceded with "n". The bool value false is encoded as `0_`, true
// value as `1_`. The char constants are encoded using their Unicode scalar
// value.
<const-data> = ["n"] {<hex-digit>} "_"

// <base-62-number> uses 0-9-a-z-A-Z as digits, i.e. 'a' is decimal 10 and
// 'Z' is decimal 61.
// "_" with no digits indicates the value 0, while any other value is offset
// by 1, e.g. "0_" is 1, "Z_" is 62, "10_" is 63, etc.
<base-62-number> = {<0-9a-zA-Z>} "_"

<backref> = "B" <base-62-number>

// We use <path> here, so that we don't have to add a special rule for
// compression. In practice, only a crate root is expected.
<instantiating-crate> = <path>

// There are no restrictions on the characters that may be used
// in the suffix following the `.` or `$`.
<vendor-specific-suffix> = ("." | "$") <suffix>
```



